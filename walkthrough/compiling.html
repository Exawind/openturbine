<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Compiling &mdash; OpenTurbine 0.0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="User Manual" href="../user/user.html" />
    <link rel="prev" title="Walkthrough" href="index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            OpenTurbine
              <img src="../_static/oturb_logo_v1.jpeg" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Walkthrough</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Compiling</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#spack-installation">Spack Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#development-using-spack-developer-workflow">Development using Spack Developer Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-and-developing-in-openturbine-directly">Building and Developing in OpenTurbine Directly</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-third-party-libraries">Installing Third Party Libraries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#clone-the-spack-repository-load-the-spack-environment-and-let-spack-learn-about-your-system">Clone the spack repository, load the spack environment, and let spack learn about your system</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-googletest">Install GoogleTest</a></li>
<li class="toctree-l4"><a class="reference internal" href="#install-trilinos">Install Trilinos</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load-the-tpls-into-your-environment">Load the TPLs into your environment</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#building-openturbine">Building OpenTurbine</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#clone-openturbine-and-setup-a-build-directory">Clone OpenTurbine and setup a build directory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configure-cmake">Configure cmake</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-and-test">Build and Test</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#build-options">Build Options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user/user.html">User Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../theory/index.html">Theory Manual</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developer/index.html">Developer Documentation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">OpenTurbine</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Walkthrough</a></li>
      <li class="breadcrumb-item active">Compiling</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/walkthrough/compiling.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="compiling">
<h1>Compiling<a class="headerlink" href="#compiling" title="Permalink to this heading"></a></h1>
<p>OpenTurbine is developed in C++17 and is designed to be buildable on any
system with a compliant compiler. It utilizes
<a class="reference external" href="https://github.com/kokkos/kokkos">Kokkos</a> and
<a class="reference external" href="https://github.com/trilinos/Trilinos">Trilinos</a> to ensure performance
portability, allowing it to run on any platform supported by these projects.
We strive to test OpenTurbine on a wide range of platforms, including Linux
and macOS, although it is not feasible to cover every possible configuration.
This document outlines the build procedure verified to work on Linux (RHEL8).
For additional assistance tailored to your specific setup, please contact the
developers.</p>
<div class="section" id="spack-installation">
<h2>Spack Installation<a class="headerlink" href="#spack-installation" title="Permalink to this heading"></a></h2>
<p>The easiest way to use OpenTurbine is through the <a class="reference external" href="https://spack.io/">Spack</a>
package manager. Once you have downloaded and set up Spack for your
environment, simply run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>install<span class="w"> </span>openturbine
</pre></div>
</div>
<p>To see the latest list of supported configuration options, check out the
package file or run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>info<span class="w"> </span>openturbine
</pre></div>
</div>
<p>Once it is installed, you can load the OpenTurbine library and its
dependencies into your environment using</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>load<span class="w"> </span>openturbine
</pre></div>
</div>
</div>
<div class="section" id="development-using-spack-developer-workflow">
<h2>Development using Spack Developer Workflow<a class="headerlink" href="#development-using-spack-developer-workflow" title="Permalink to this heading"></a></h2>
<p>One easy way to set up a development environment for OpenTurbine is to use
Spack’s Developer Workflow. To setup an environment for working on
OpenTurbine, setup Spack and then run the following commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mkdir<span class="w"> </span>openturbine
<span class="nb">cd</span><span class="w"> </span>openturbine
spack<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-d<span class="w"> </span>.
spack<span class="w"> </span>env<span class="w"> </span>activate<span class="w"> </span>.
spack<span class="w"> </span>add<span class="w"> </span>openturbine+tests
spack<span class="w"> </span>install
spack<span class="w"> </span>develop<span class="w"> </span>openturbine@main
spack<span class="w"> </span>concretize<span class="w"> </span>-f
spack<span class="w"> </span>install
</pre></div>
</div>
<p>OpenTurbine’s source code will now be located in the openturbine folder, but
can be accessed from anywhere by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-c<span class="w"> </span>openturbine
</pre></div>
</div>
<p>After editing the code here, it can be rebuilt by running</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>install
</pre></div>
</div>
<p>To run the tests, first access the build folder through the spack command</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>-b<span class="w"> </span>openturbine
</pre></div>
</div>
<p>Next, the tests can be run either through ctest or directly from the unit
test or regression test executables</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>ctest
./tests/unit_tests/openturbine_unit_tests
./tests/regression_tests/openturbine_regression_tests
</pre></div>
</div>
<p>You can also build OpenTurbine from this folder using standard make
commands.</p>
<p>For more information, please see Spack’s documentation:
<a class="reference external" href="https://spack-tutorial.readthedocs.io/en/latest/tutorial_developer_workflows.html">https://spack-tutorial.readthedocs.io/en/latest/tutorial_developer_workflows.html</a></p>
</div>
<div class="section" id="building-and-developing-in-openturbine-directly">
<h2>Building and Developing in OpenTurbine Directly<a class="headerlink" href="#building-and-developing-in-openturbine-directly" title="Permalink to this heading"></a></h2>
<p>The following sections outline how to build and develop OpenTurbine without
Spack’s Developer Workflows. The main complication here is that developers
will have to manage their environment and dependencies manually, which may
be an unnecessary complication or a freeing feature, depending on your
perspective.</p>
</div>
<div class="section" id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading"></a></h2>
<p>Before building OpenTurbine, you’ll need the following:</p>
<ul class="simple">
<li><p>C++ compiler that supports the C++17 standard</p></li>
<li><p><a class="reference external" href="https://cmake.org/">CMake</a>: the default build system for C++ projects,
version 3.21 or later</p></li>
<li><p><a class="reference external" href="https://github.com/kokkos/kokkos">Kokkos</a>: core programming model for
performance portability</p></li>
<li><p><a class="reference external" href="https://github.com/kokkos/kokkoskernels">KokkosKernels</a>: performance
portable linear algebra library</p></li>
<li><p><a class="reference external" href="https://github.com/trilinos/Trilinos">Trilinos</a>: primarily for the
Amesos2 sparse direct linear solver package</p></li>
<li><p><a class="reference external" href="https://github.com/google/googletest">GoogleTest</a>: unit testing package</p></li>
</ul>
</div>
<div class="section" id="installing-third-party-libraries">
<h2>Installing Third Party Libraries<a class="headerlink" href="#installing-third-party-libraries" title="Permalink to this heading"></a></h2>
<p>There are several methods to obtain the necessary Third Party Libraries
(TPLs) for building OpenTurbine, however the simplest is to use the
<a class="reference external" href="https://spack.io/">spack</a> package manager. Spack offers a
comprehensive set of features for development and dependency management. The
following is a quick-start guide for installing and loading the TPLs required
to build OpenTurbine.</p>
<div class="section" id="clone-the-spack-repository-load-the-spack-environment-and-let-spack-learn-about-your-system">
<h3>Clone the spack repository, load the spack environment, and let spack learn about your system<a class="headerlink" href="#clone-the-spack-repository-load-the-spack-environment-and-let-spack-learn-about-your-system" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:spack/spack.git
<span class="nb">source</span><span class="w"> </span>spack/share/spack/setup-env.sh
spack<span class="w"> </span>compiler<span class="w"> </span>find
spack<span class="w"> </span>external<span class="w"> </span>find
</pre></div>
</div>
</div>
<div class="section" id="install-googletest">
<h3>Install GoogleTest<a class="headerlink" href="#install-googletest" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>install<span class="w"> </span>googletest
</pre></div>
</div>
</div>
<div class="section" id="install-trilinos">
<h3>Install Trilinos<a class="headerlink" href="#install-trilinos" title="Permalink to this heading"></a></h3>
<p>To build OpenTurbine, Kokkos Kernels must be configured to use the LAPACK
and BLAS TPLs. For GPU builds, Trilinos should be compiled with support for
the Basker linear solver. Additionally, we typically disable EPetra to avoid
deprecation warnings. As of this writing, OpenTurbine is compatible with
Trilinos version 16.0.0, which is the latest and default version in spack.</p>
<p>For a simple serial build</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>install<span class="w"> </span>trilinos~epetra<span class="w"> </span>^kokkos-kernels+blas+lapack
</pre></div>
</div>
<p>Trilinos can also be compiled with OpenMP support for parallelism on CPU based machines</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>install<span class="w"> </span>trilinos~epetra+openmp<span class="w"> </span>^kokkos-kernels+blas+lapack
</pre></div>
</div>
<p>If building for CUDA platforms, Trilinos must be configured with CUDA support</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>install<span class="w"> </span>trilinos~epetra+basker+cuda<span class="w"> </span>^kokkos-kernels+blas+lapack
</pre></div>
</div>
<p>If building for ROCm platforms, Trilinos must be configured with ROCm support</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>install<span class="w"> </span>trilinos~epetra+basker+rocm<span class="w"> </span>^kokkos-kernels+blas+lapack
</pre></div>
</div>
<p>Trilinos can be built with or without MPI support.</p>
</div>
<div class="section" id="load-the-tpls-into-your-environment">
<h3>Load the TPLs into your environment<a class="headerlink" href="#load-the-tpls-into-your-environment" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>spack<span class="w"> </span>load<span class="w"> </span>googletest
spack<span class="w"> </span>load<span class="w"> </span>trilinos
</pre></div>
</div>
<p>Trilinos can be compiled with support for various platforms. While it is
assumed that OpenTurbine will inherit compatibility with these platforms,
they have not been tested at the time of writing.</p>
<p>If you choose not to use Spack, you must manually build all dependencies.
Please ensure that the <code class="docutils literal notranslate"><span class="pre">Amesos2_DIR</span></code>, <code class="docutils literal notranslate"><span class="pre">GTest_DIR</span></code>, and <code class="docutils literal notranslate"><span class="pre">KokkosKernels_DIR</span></code>
environment variables are correctly set for these packages. Alternatively,
make sure that CMake’s <code class="docutils literal notranslate"><span class="pre">find_package</span></code> utility can locate them.</p>
</div>
</div>
<div class="section" id="building-openturbine">
<h2>Building OpenTurbine<a class="headerlink" href="#building-openturbine" title="Permalink to this heading"></a></h2>
<p>The following is written assuming the TPLs in hand and the environment
configured as described above.</p>
<div class="section" id="clone-openturbine-and-setup-a-build-directory">
<h3>Clone OpenTurbine and setup a build directory<a class="headerlink" href="#clone-openturbine-and-setup-a-build-directory" title="Permalink to this heading"></a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:Exawind/openturbine.git
<span class="nb">cd</span><span class="w"> </span>openturbine
mkdir<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build
</pre></div>
</div>
</div>
<div class="section" id="configure-cmake">
<h3>Configure cmake<a class="headerlink" href="#configure-cmake" title="Permalink to this heading"></a></h3>
<p>For a CPU-based build which includes building unit tests, use</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake<span class="w"> </span>../
</pre></div>
</div>
<p>If Trilinos was built with CUDA support, you will need to use the nvcc_wrapper
for compilation</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake<span class="w"> </span>../<span class="w"> </span>-DCMAKE_CXX_COMPILER<span class="o">=</span>nvcc_wrapper
</pre></div>
</div>
<p>If Trilinos was built with ROCm support, you will need to use the hipcc program
for compilation</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cmake<span class="w"> </span>../<span class="w"> </span>-DCMAKE_CXX_COMPILER<span class="o">=</span>hipcc
</pre></div>
</div>
</div>
<div class="section" id="build-and-test">
<h3>Build and Test<a class="headerlink" href="#build-and-test" title="Permalink to this heading"></a></h3>
<p>Currently, OpenTurbine builds several shared libraries by default. To ensure
that their unit tests pass, these libraries must be copied into the directory
where the tests are executed.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>-j
cp<span class="w"> </span>src/*.dll<span class="w"> </span>tests/unit_tests/
ctest<span class="w"> </span>--output-on-failure
</pre></div>
</div>
<p>Once built, the unit test executable can also be run directly from the build
directory</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./tests/unit_tests/openturbine_unit_tests
</pre></div>
</div>
</div>
</div>
<div class="section" id="build-options">
<h2>Build Options<a class="headerlink" href="#build-options" title="Permalink to this heading"></a></h2>
<p>OpenTurbine has several build options which can be set either when running
CMake from the command line or through a GUI such as ccmake.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">OpenTurbine_ENABLE_CLANG_TIDY</span></code> enables the Clang-Tidy static analysis tool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OpenTurbine_ENABLE_COVERAGE</span></code> enables code coverage analysis using gcov</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OpenTurbine_ENABLE_CPPCHECK</span></code> enables the CppCheck static analysis tool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OpenTurbine_ENABLE_IPO</span></code> enables link time optimization</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OpenTurbine_ENABLE_PCH</span></code> builds precompiled headers to potentially decrease
compilation time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OpenTurbine_ENABLE_SANITIZER_ADDRESS</span></code> enables the address sanitizer runtime
analysis tool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OpenTurbine_ENABLE_SANITIZER_LEAK</span></code> enables the leak sanitizer runtime
analysis tool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OpenTurbine_ENABLE_SANITIZER_MEMORY</span></code> enables the memory sanitizer runtime
analysis tool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OpenTurbine_ENABLE_SANITIZER_THREAD</span></code> enables the thread sanitizer runtime
analysis tool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OpenTurbine_ENABLE_SANITIZER_UNDEFINED</span></code> enables the undefined behavior
sanitizer runtime analysis tool</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OpenTurbine_ENABLE_TESTS</span></code> builds OpenTurbine’s test suite</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OpenTurbine_ENABLE_UNITY_BUILD</span></code> uses unity builds to potentially decrease
compilation time</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OpenTurbine_ENABLE_VTK</span></code> builds OpenTurbine with VTK support for
visualization in tests. Will need the VTK TPL to be properly configured</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">OpenTurbine_WARNINGS_AS_ERRORS</span></code> treats warnings as errors, including
warnings from static analysis tools</p></li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="index.html" class="btn btn-neutral float-left" title="Walkthrough" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../user/user.html" class="btn btn-neutral float-right" title="User Manual" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023 - Present, MIT License.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>